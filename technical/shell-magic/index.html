<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Shell Magic &#8211; Srijan R. Shetty</title>
<meta name="description" content="Saving an Ubuntu in distress with some commandline-fu">
<meta name="keywords" content="linux, sed, awk, grep, apt-get, technical">


<!-- Twitter Cards -->
<meta name="twitter:title" content="Shell Magic">
<meta name="twitter:description" content="Saving an Ubuntu in distress with some commandline-fu">
<meta name="twitter:site" content="@srijanshetty">
<meta name="twitter:creator" content="@srijanshetty">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="//srijanshetty.in/images/default-thumb.png">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Shell Magic">
<meta property="og:description" content="Saving an Ubuntu in distress with some commandline-fu">
<meta property="og:url" content="//srijanshetty.in/technical/shell-magic/">
<meta property="og:site_name" content="Srijan R. Shetty">

<meta property="og:image" content="//srijanshetty.in/images/default-thumb.png">






<link rel="canonical" href="//srijanshetty.in/technical/shell-magic/">
<link href="//srijanshetty.in/feed.xml" type="application/atom+xml" rel="alternate" title="Srijan R. Shetty Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="//srijanshetty.in/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="//srijanshetty.in/assets/js/vendor/html5shiv.min.js"></script>
	<script src="//srijanshetty.in/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="//srijanshetty.in/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="//srijanshetty.in/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="//srijanshetty.in/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="//srijanshetty.in/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="//srijanshetty.in/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="//srijanshetty.in/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="//srijanshetty.in/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="//srijanshetty.in/">Srijan R. Shetty</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				    
				    <li><a href="//srijanshetty.in/about/" >About</a></li>
				
				    
				    <li><a href="//srijanshetty.in/cv/cv.pdf" >CV</a></li>
				
				    
				    <li><a href="//srijanshetty.in/posts/" >Blog</a></li>
				
				    
				    <li><a href="//srijanshetty.in/posts/category-wise/" >Categories</a></li>
				
				    
				    <li><a href="//srijanshetty.in/almanac/" >Almanac</a></li>
				
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main">
  <div class="article-author-side">
    

<div itemscope itemtype="http://schema.org/Person">


	<img src="//srijanshetty.in/images/bio-photo.jpg" class="bio-photo" alt="Srijan R. Shetty bio photo">


  <h3 itemprop="name">Srijan R. Shetty</h3>
  <p></p>
  <a href="mailto:srijan.shetty+code@gmail.com" class="author-social" target="_blank" rel="noopener"><i class="fa fa-fw fa-envelope-square"></i> Email</a>
  <a href="http://twitter.com/srijanshetty" class="author-social" target="_blank" rel="noopener"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a>
  
  
  <a href="http://linkedin.com/in/srijanshetty" class="author-social" target="_blank" rel="noopener"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a>
  
  
  
  <a href="http://github.com/srijanshetty" class="author-social" target="_blank" rel="noopener"><i class="fa fa-fw fa-github"></i> Github</a>
  
  
  
  
  
  
  
  
  
  
  
<a href="" class="author-social" target="_blank"><i class="fa fa-fw fa-rss"></i> RSS </a>
</div>

  </div>
  <article class="post">
    <div class="headline-wrap">
      
        <h1><a href="//srijanshetty.in/technical/shell-magic/" rel="bookmark" title="Shell Magic">Shell Magic</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <p>The other day, a friend of mine ran the following command in an attempt to remove wine and it’s dependants.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">sudo </span>apt-get purge wine <span class="k">*</span></code></pre></figure>

<p>Unfortunately for him, the command worked and did end up removing wine with a whole lot of other system critical
packages. In an attempt to resuscitate his computer, he tried rebooting it and in the moments that ensued, I can
swear I saw the living daylights sucked out of his face. But every cloud has a silver lining and despite the fact
that we could not boot into X, we did have shell access. <br /><br />
Fortunately for us, <strong>apt</strong> maintains a log of all the operations it performs in <em>/var/log/apt/term.log</em> and while
it would have been easy to just manually make a list of programs that were uninstalled, it wasn’t <a href="https://www.youtube.com/watch?v=sCZJblyT_XM">half-assed
</a> enough. Instead, we summoned the Gods of the shell to aid us in
this conquest.<br /><br />
We began by getting the relevant portion of the log file to another file (while it is possible to work with the
same log file, we didn’t want to go through the hassle of using <strong>sudo</strong> every time we had to access the log file.)</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">sudo tail</span> <span class="nt">-177</span> /var/log/apt/term.log <span class="o">&gt;</span> temp.log</code></pre></figure>

<p>I’ll admit, we cheated a bit by using <strong>177</strong> and while it could have been programmed easily using <strong>grep</strong>, we were
more excited about what we had to do next to really worry about making all of this reproducible.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">Log started: 2015-05-01  10:36:15
Removing cmake
Processing triggers <span class="k">for </span>man-db
Log ended: 2015-05-01  10:36:29</code></pre></figure>

<p>As you can see above, <strong>apt</strong> logs all removed programs as *Removing <program_name>*, so a simple **grep** search
would list all the lines containing the removed programs and the second field of these lines would get us
a list of all the programs which were removed by this operation. <br /></program_name></p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cat </span>temp.log | <span class="nb">grep</span> <span class="s1">'^Removing'</span> | <span class="nb">awk</span> <span class="s1">'{print \$2}'</span></code></pre></figure>

<p>The carat in <strong>grep</strong>’s argument signifies that we want all lines starting with the word ‘Removing’. Also,
we use <strong>awk</strong> to obtain the second field of the lines (an astute reader may suggest alternatives like
<strong>cut</strong> as well). <br /><br />
Now that we had a list of the uninstalled programs, all that is left is feeding this list to <strong>apt</strong> for
installation.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cat </span>temp.log | <span class="nb">grep</span> <span class="s1">'^Removing'</span> | <span class="nb">awk</span> <span class="s1">'{print \$2}'</span> | xargs <span class="nb">sudo </span>apt-get <span class="nb">install</span> <span class="nt">-y</span></code></pre></figure>

<p>And viola! All was back to normal in Linux Land.</p>

      <hr />
      <footer role="contentinfo">
        <div class="social-share">
  <h4>Share on</h4>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=//srijanshetty.in/technical/shell-magic/" class="twitter" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=//srijanshetty.in/technical/shell-magic/" class="facebook" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=//srijanshetty.in/technical/shell-magic/" class="google-plus" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
  </ul>
</div><!-- /.social-share -->
        <p class="byline"><strong>Shell Magic</strong> was published on <time datetime="2015-05-04T15:45:32+05:30">May 04, 2015</time>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="//srijanshetty.in/posts/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="//srijanshetty.in/write-ups/oars-sql-injections-and-paper-backups/" title="OARS, SQL Injections and Paper Backups">OARS, SQL Injections and Paper Backups</a></li>
    
      <li><a href="//srijanshetty.in/write-ups/a-professor-can-bunk-as-well/" title="The based professors of IIT Kanpur - 2">The based professors of IIT Kanpur - 2</a></li>
    
      <li><a href="//srijanshetty.in/write-ups/based-professors-of-iitk-professor-tvp/" title="The based professors of IIT Kanpur - Professor TVP">The based professors of IIT Kanpur - Professor TVP</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  
  <footer>
    

<span>&copy; 2023 Srijan R. Shetty. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a> theme.</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="//srijanshetty.in/assets/js/vendor/jquery-3.4.1.min.js"><\/script>')</script>
<script src="//srijanshetty.in/assets/js/scripts.min.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-54744194-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


  
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'srijanshetty'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>





</body>
</html>
